<?xml version="1.0" encoding="UTF-8"?>
<!-- This is the liquibase file for milestone 1 -->

<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

    <changeSet id="milestone_1_add_deleted_column_to_notes" author="vega">
        <addColumn tableName="notes">
            <column name="is_deleted" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <addColumn tableName="notes">
            <column name="last_updated" type="datetime" defaultValueComputed="CURRENT_TIMESTAMP">
                <constraints nullable="true"/>
            </column>
        </addColumn>
        <addColumn tableName="notes">
            <column name="last_deleted" type="datetime">
                <constraints nullable="true"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="milestone_1_delete-triggers-with-parent" author="vega">
        <delete tableName="triggers">
            <where>trigger_parent_id IS NOT NULL</where>
        </delete>
    </changeSet>

    <changeSet id="add_description_suggestion_to_notes" author="vega">
        <addColumn tableName="notes">
            <column name="description" type="varchar(255)" />
            <column name="suggestion" type="varchar(255)" />
        </addColumn>
    </changeSet>

    <changeSet id="modify_suggestion_to_text" author="vega">
        <modifyDataType tableName="notes" columnName="suggestion" newDataType="TEXT" />
    </changeSet>
    <changeSet id="modify_description_to_text" author="vega">
        <modifyDataType tableName="notes" columnName="description" newDataType="TEXT" />
    </changeSet>

    <changeSet id="modify_text_to_text" author="vega">
        <modifyDataType tableName="notes" columnName="text" newDataType="TEXT" />
    </changeSet>

    <changeSet id="milestone_1_delete_sub_emotion_suggested_actions" author="yuri.zelikov">
        <dropTable tableName="sub_emotion_suggested_actions"/>
    </changeSet>

    <changeSet id="milestone_1_delete_suggested_actions" author="yuri.zelikov">
        <dropTable tableName="suggested_actions"/>
    </changeSet>



</databaseChangeLog>